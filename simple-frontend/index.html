<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solana Bonding Curve System Client</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Include Solana Web3.js (specifying version 1.x) -->
    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>

    <!-- Include Anchor library (current version) -->
    <script src="https://unpkg.com/@coral-xyz/anchor@0.29.0/dist/browser/anchor.min.js"></script>

    <!-- Wait for libraries to load before importing modules -->
    <script>
      window.addEventListener("load", function () {
        // Check if Solana Web3.js library is loaded (it's the only one we can reliably detect)
        if (window.solanaWeb3) {
          console.log("Solana Web3.js library loaded successfully");

          // Create a global anchor object with necessary structure if it doesn't exist
          if (!window.anchor) {
            console.log(
              "Creating anchor global object with required structure"
            );
            // Create a complete placeholder structure to avoid undefined property errors
            window.anchor = {
              AnchorProvider: function () {
                return {};
              },
              Program: function () {
                return {};
              },
              setProvider: function () {},
              spl: {
                TOKEN_PROGRAM_ID: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA", // Default Solana token program ID
              },
              BN: function (n) {
                return n;
              },
              web3: {},
              utils: {},
            };
          }

          // Create a mock Phantom wallet if it doesn't exist
          if (!window.solana) {
            console.log("Creating mock Phantom wallet for testing");
            window.solana = {
              isPhantom: true,
              connect: function () {
                console.log("Mock wallet connected");
                return Promise.resolve({
                  publicKey: new solanaWeb3.PublicKey(
                    "8YLKoCu7NwqHNS8GzuvA2ibsvLrsg22YMfMDafxh1B4k"
                  ),
                  isConnected: true,
                });
              },
              disconnect: function () {
                console.log("Mock wallet disconnected");
                return Promise.resolve();
              },
              signTransaction: function (transaction) {
                console.log("Mock transaction signed");
                return Promise.resolve(transaction);
              },
              signAllTransactions: function (transactions) {
                console.log("Mock transactions signed");
                return Promise.resolve(transactions);
              },
            };
          }

          // Load the main module after libraries are ready
          const script = document.createElement("script");
          script.type = "module";
          script.src = "js/main.js";
          document.head.appendChild(script);
        } else {
          console.error("Solana Web3.js library not loaded");
        }
      });
    </script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Solana Bonding Curve System</h1>
        <p>Interact with your deployed Solana contract</p>
      </header>

      <section class="wallet-section">
        <h2>Wallet Connection</h2>
        <div id="wallet-status">Not connected</div>
        <button id="connect-wallet">Connect Wallet</button>
        <div id="wallet-info" class="hidden">
          <p>Address: <span id="wallet-address"></span></p>
          <p>Balance: <span id="wallet-balance"></span> SOL</p>
        </div>
      </section>

      <section class="contract-section">
        <h2>Contract Information</h2>
        <div class="info-box">
          <p>
            Program ID:
            <span id="program-id"
              >EQ8z6eXcaVH6ryUWCWhjmnaZRLSamz5ZRAWswJtAjUXR</span
            >
          </p>
          <p>Network: <span id="network">Devnet</span></p>
        </div>
      </section>

      <section class="functions-section">
        <h2>Contract Functions</h2>

        <div class="function-card">
          <h3>Create User</h3>
          <div class="input-group">
            <label for="max-nfts">Max NFTs:</label>
            <input type="number" id="max-nfts" value="5" />
          </div>
          <button id="create-user-btn">Create User</button>
          <div class="result" id="create-user-result"></div>
        </div>

        <div class="function-card">
          <h3>Create Pool</h3>
          <div class="input-group">
            <label for="base-price">Base Price:</label>
            <input type="number" id="base-price" value="1000000" />
          </div>
          <div class="input-group">
            <label for="growth-factor">Growth Factor:</label>
            <input type="number" id="growth-factor" value="3606" />
          </div>
          <button id="create-pool-btn">Create Pool</button>
          <div class="result" id="create-pool-result"></div>
        </div>

        <div class="function-card">
          <h3>Buy Token</h3>
          <div class="input-group">
            <label for="buy-amount">Amount:</label>
            <input type="number" id="buy-amount" value="10000000" />
          </div>
          <button id="buy-token-btn">Buy Token</button>
          <div class="result" id="buy-token-result"></div>
        </div>

        <div class="function-card">
          <h3>Sell Token</h3>
          <div class="input-group">
            <label for="sell-amount">Amount:</label>
            <input type="number" id="sell-amount" value="5000000" />
          </div>
          <button id="sell-token-btn">Sell Token</button>
          <div class="result" id="sell-token-result"></div>
        </div>

        <div class="function-card">
          <h3>Create NFT</h3>
          <div class="input-group">
            <label for="nft-name">Name:</label>
            <input type="text" id="nft-name" value="My NFT" />
          </div>
          <div class="input-group">
            <label for="nft-symbol">Symbol:</label>
            <input type="text" id="nft-symbol" value="MNFT" />
          </div>
          <div class="input-group">
            <label for="nft-uri">URI:</label>
            <input
              type="text"
              id="nft-uri"
              value="https://example.com/nft.json"
            />
          </div>
          <div class="input-group">
            <label for="seller-fee">Seller Fee (basis points):</label>
            <input type="number" id="seller-fee" value="500" />
          </div>
          <button id="create-nft-btn">Create NFT</button>
          <div class="result" id="create-nft-result"></div>
        </div>

        <div class="function-card">
          <h3>Buy NFT</h3>
          <div class="input-group">
            <label for="nft-mint">NFT Mint Address:</label>
            <input
              type="text"
              id="nft-mint"
              placeholder="Enter NFT mint address"
            />
          </div>
          <button id="buy-nft-btn">Buy NFT</button>
          <div class="result" id="buy-nft-result"></div>
        </div>
      </section>

      <section class="transaction-section">
        <h2>Transaction History</h2>
        <div id="transaction-list">
          <p>No transactions yet</p>
        </div>
      </section>
    </div>
  </body>
</html>
